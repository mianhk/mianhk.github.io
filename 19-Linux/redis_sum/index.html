<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Linux,后台开发,Redis,Nosql," />





  <link rel="alternate" href="/atom.xml" title="Mianhk's notes" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="《redis 设计与实现》–总结 Redis设计与实现，以及关于Redis使用的总结">
<meta name="keywords" content="Linux,后台开发,Redis,Nosql">
<meta property="og:type" content="article">
<meta property="og:title" content="《redis 设计与实现》--总结">
<meta property="og:url" content="http://yoursite.com/19-Linux/redis_sum/index.html">
<meta property="og:site_name" content="Mianhk&#39;s notes">
<meta property="og:description" content="《redis 设计与实现》–总结 Redis设计与实现，以及关于Redis使用的总结">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://blog-1252063226.cosbj.myqcloud.com/network/20180619151556.png">
<meta property="og:image" content="http://blog-1252063226.cosbj.myqcloud.com/network/20180619154918.png">
<meta property="og:image" content="http://blog-1252063226.cosbj.myqcloud.com/network/20180619162843.png">
<meta property="og:updated_time" content="2018-06-19T14:13:33.929Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="《redis 设计与实现》--总结">
<meta name="twitter:description" content="《redis 设计与实现》–总结 Redis设计与实现，以及关于Redis使用的总结">
<meta name="twitter:image" content="http://blog-1252063226.cosbj.myqcloud.com/network/20180619151556.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/19-Linux/redis_sum/"/>





  <title>《redis 设计与实现》--总结 | Mianhk's notes</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-106121016-1', 'auto');
  ga('send', 'pageview');
</script>











</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Mianhk's notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">这个人很懒，动不动就不想写</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-books">
          <a href="/books" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            看书
          </a>
        </li>
      
        
        <li class="menu-item menu-item-movies">
          <a href="/movies" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            电影
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            我
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/19-Linux/redis_sum/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mianhk">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mianhk's notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">《redis 设计与实现》--总结</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-19T18:50:41+08:00">
                2018-06-19
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2018-06-19T22:13:33+08:00">
                2018-06-19
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="《redis-设计与实现》–总结"><a href="#《redis-设计与实现》–总结" class="headerlink" title="《redis 设计与实现》–总结"></a>《redis 设计与实现》–总结</h1><blockquote>
<p>Redis设计与实现，以及关于Redis使用的总结  </p>
</blockquote>
<a id="more"></a>
<h2 id="1-数据结构与对象"><a href="#1-数据结构与对象" class="headerlink" title="1.数据结构与对象"></a>1.数据结构与对象</h2><h3 id="1-简单动态字符串"><a href="#1-简单动态字符串" class="headerlink" title="1.简单动态字符串"></a>1.简单动态字符串</h3><p>Redis自己构建了简单动态字符串(Simple Dynamic String,SDS)来作为默认的字符串表示。<br>SDS的构造如下：<br><img src="http://blog-1252063226.cosbj.myqcloud.com/network/20180619151556.png"><br>优势是：</p>
<ol>
<li>能够在常数时间内获取字符串的长度-通过len属性   </li>
<li>能够杜绝缓冲区溢出：记录了缓冲区的大小，在长度不够时，能够自动扩展空间  </li>
<li>减少修改字符串时带来的内存重新分配次数：采用空间预分配和惰性空间释放  <h3 id="2-链表"><a href="#2-链表" class="headerlink" title="2.链表"></a>2.链表</h3>Redis自己实现了链表。拥有以下特性：双端无环、带表头指针和表尾指针、带链表长度计数器、多态(使用void* 保存节点值)<h3 id="3-字典"><a href="#3-字典" class="headerlink" title="3.字典"></a>3.字典</h3>Redis字典底层采用哈希表实现。采用MurmurHash2算法，解决键冲突的方式是：链地址法。<br>哈希表的扩展与收缩：以下条件满足时：  </li>
<li>服务器没有执行BGSAVE或BGREWRITEAOF命令，哈希表负载因子&gt;1  </li>
<li>服务器在执行BGSAVE或BGREWRITEAOF命令，哈希表负载因子&gt;5  </li>
</ol>
<h3 id="4-跳跃表"><a href="#4-跳跃表" class="headerlink" title="4.跳跃表"></a>4.跳跃表</h3><p>Redis采用跳跃表作为有序集合键的底层数据结构，另：在集群节点中用作内部数据结构<br>跳跃表：一种有序数据结构，通过在一个节点维持多个指向其他节点的指针，从而达到快速访问节点的目的。支持平均O(logN),最差O(N)复杂度的查找。<br>Redis中跳跃表的实现：</p>
<p><div align="center"> <img src="http://blog-1252063226.cosbj.myqcloud.com/network/20180619154918.png"> </div><br><br>其中包括表头和表尾节点，length记录节点的数量，level用于获取跳跃表中层高最大的那个节点的层数量 （表头节点的层高不计算在内）    </p>
<h3 id="5-整数集合"><a href="#5-整数集合" class="headerlink" title="5.整数集合"></a>5.整数集合</h3><p>Redis中集合键的底层实现之一，当一个集合只包含整数值元素，并且这个集合中元素的数量不多时，就会使用整数集合作为集合键的底层实现。<br>整数集合的升级策略：能够提高整数集合的灵活性，并且能够尽可能的节约内存。升级后不支持降级  </p>
<h3 id="6-压缩列表"><a href="#6-压缩列表" class="headerlink" title="6.压缩列表"></a>6.压缩列表</h3><p>Redis中列表键和哈希键的底层实现之一。  </p>
<h3 id="7-对象"><a href="#7-对象" class="headerlink" title="7.对象"></a>7.对象</h3><p>Redis使用上述的数据结构创建了一个对象系统。包括：字符串对象、列表对象、哈希对象、集合对象和有序集合对象。其实这就是一直说的Redis五种数据结构：字符串、列表、字典、集合、有序集合。</p>
<h2 id="2-单机数据库的实现"><a href="#2-单机数据库的实现" class="headerlink" title="2.单机数据库的实现"></a>2.单机数据库的实现</h2><h3 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h3><p>Redis服务器讲所有数据库保存在一个db数组中，默认创建16个数据库。<br>切换数据库:<code>select 0 #选择0号数据库</code>  </p>
<h4 id="数据库键空间"><a href="#数据库键空间" class="headerlink" title="数据库键空间"></a>数据库键空间</h4><p>键空间的键也是数据库的键。每个键都是一个字符串对象。<br>键空间的值也是数据库的值，每个值可以是字符串对象、列表对象、哈希对象、集合对象，有序集合对象中的任意一个Redis对象。<br>一个键空间的例子：</p>
<p><div align="center"> <img src="http://blog-1252063226.cosbj.myqcloud.com/network/20180619162843.png"> </div><br></p>
<h4 id="设置键的生存时间或过期时间"><a href="#设置键的生存时间或过期时间" class="headerlink" title="设置键的生存时间或过期时间"></a>设置键的生存时间或过期时间</h4><p>原理是：过期时间是一个UNIX时间戳，当键的过期时间来临是，服务器就会自动从数据库中删除一个键。<br>命令:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">expire &lt;key&gt; &lt;ttl&gt;  #key的生存时间为ttl秒</div><div class="line">pexpire &lt;key&gt; &lt;ttl&gt;  #key的生存时间为ttl毫秒</div><div class="line">expireat &lt;key&gt; &lt;timestamp&gt;  #key的生存时间直到timestamp指定的时间戳s</div><div class="line">pexpireat &lt;key&gt; &lt;timestamp&gt;  #key的生存时间直到timestamp指定的时间戳ms</div><div class="line"></div><div class="line">persist &lt;key&gt;  #移除key的过期时间</div><div class="line">ttl &lt;key&gt;   #计算key的剩余生存时间</div><div class="line">```    </div><div class="line">    </div><div class="line">setex命令可以设置一个字符串键的同时为键设置过期时间。</div><div class="line">一个带有过期字典的数据库例子：（实际中，键空间的键和过期字典中的键都指向同一个键对象）</div><div class="line">&lt;div align=&quot;center&quot;&gt; &lt;img src=&quot;http://blog-1252063226.cosbj.myqcloud.com/network/20180619163748.png&quot; /&gt; &lt;/div&gt;&lt;br&gt;</div><div class="line"></div><div class="line">#### 过期键删除策略</div><div class="line">- 定时删除： 内存最友好，CPU时间最不友好   </div><div class="line">- 惰性删除：CPU时间友好，内存不友好  </div><div class="line">- 定期删除：折中</div><div class="line">Redis实际使用：惰性删除和定期删除配合使用。</div><div class="line"></div><div class="line">#### 过期键的处理</div><div class="line">1. RDB文件：</div><div class="line">生成RDB文件：已过期的键不会保存到新创建的RDB文件中，因此对生成新的RDB文件没有影响。</div><div class="line">载入RDB文件：主服务器模式时，过期键不会被载入。从服务器模式时，都会被载入，但同步后，从服务器数据会被清空，所以也没有影响。  </div><div class="line">2. AOF文件：</div><div class="line">AOF写入：如果某个键已经过期，但没有被删除，AOF文件不会因为这个过期键产生任何影响。如果已经删除，AOF文件会追加一条DEL命令显式记录该键已被删除。  </div><div class="line">AOF重写：已过期的键不会被保存到重写的AOF文件。  </div><div class="line">3. 复制：  </div><div class="line">主服务器删除一个过期键，会显示向所有的从服务器发送DEL命令，告知删除。  </div><div class="line">从服务器遇到过期的键也不会删除。只有接收到DEL命令后才会删除过期键。  </div><div class="line"></div><div class="line">### RDB持久化</div><div class="line">通过保存数据库中的键值对来记录数据库状态不同。  </div><div class="line">功能：将Redis在内存中的数据库状态保存到磁盘中，避免数据意外丢失。RDB文件是一个经过压缩的二进制文件，保存在硬盘中，因此Redis进程退出，只要RDB文件仍在，就可以用来还原数据库的状态。  </div><div class="line">#### RDB文件的创建和载入</div><div class="line">服务器在载入RDB文件期间，会一直阻塞。  </div><div class="line">SAVE命令由服务器进程执行保存工作，因此会阻塞服务器。BGSAVE命令由子进程执行保存工作。</div><div class="line">#### 自动间隔性保存</div><div class="line">设置服务器配置的save选项，让服务器每隔一段时间自动执行一次BGSAVE命令。</div></pre></td></tr></table></figure></p>
<p>save 900 1  # 900s内发生了至少一次修改<br>save 300 10<br>save 60 10000<br>满足上述一个条件，BASAVE就会执行。<br>```</p>
<h4 id="RDB文件结构"><a href="#RDB文件结构" class="headerlink" title="RDB文件结构"></a>RDB文件结构</h4><table>
<thead>
<tr>
<th style="text-align:center">头部</th>
<th style="text-align:center">数据库版本</th>
<th style="text-align:center">数据</th>
<th style="text-align:center">正文结束符</th>
<th style="text-align:center">校验和</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">REDIS</td>
<td style="text-align:center">db_version</td>
<td style="text-align:center">databases</td>
<td style="text-align:center">EOF</td>
<td style="text-align:center">check_sum</td>
</tr>
</tbody>
</table>
<h3 id="AOF持久化-Append-Only-File"><a href="#AOF持久化-Append-Only-File" class="headerlink" title="AOF持久化(Append Only File)"></a>AOF持久化(Append Only File)</h3><p>通过保存Redis服务器所执行的写命令来记录数据库状态。   </p>
<h4 id="AOF持久化的实现过程"><a href="#AOF持久化的实现过程" class="headerlink" title="AOF持久化的实现过程"></a>AOF持久化的实现过程</h4><p>命令追加:将内容追加到aof_buf缓冲区的末尾。<br>写入与同步：服务器每次结束一个时间循环之前，都会调用flushAppendOnlyFile函数，考虑是否将aof_buf缓冲区中的内容写入和保存到AOF文件中。选项值为：alwals,everysec,no<br>载入与数据还原：还原过程：创建一个不带网络连接的伪客户端；从AOF文件中分析并读取一条写命令；使用伪客户端执行被读出的写命令；循环处理。  </p>
<h4 id="AOF重写"><a href="#AOF重写" class="headerlink" title="AOF重写"></a>AOF重写</h4><p>目的：解决AOF文件体积膨胀。<br>实现原理：从数据库中读取键现在的值，然后用一条命令去记录键值对，代替之前记录这个键值对的多条命令。<br>后台重写：子进程AOF重写期间，服务器进程可以继续处理命令请求。<br>后台重写问题：子进程重写期间，服务器还需要处理命令请求，可能导致服务器当前数据库状态和重写后的AOF文件所保存的数据库状态不一致。解决办法：AOF重写缓冲区。</p>
<h3 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h3><h4 id="文件事件"><a href="#文件事件" class="headerlink" title="文件事件"></a>文件事件</h4><p>文件事件处理器。基于Reactor模式，使用IO多路复用程序同时监听多个套接字。</p>
<h2 id="3-多机数据库的实现"><a href="#3-多机数据库的实现" class="headerlink" title="3.多机数据库的实现"></a>3.多机数据库的实现</h2><h2 id="4-独立功能的实现"><a href="#4-独立功能的实现" class="headerlink" title="4.独立功能的实现"></a>4.独立功能的实现</h2><h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="AOF和RDB比较"><a href="#AOF和RDB比较" class="headerlink" title="AOF和RDB比较"></a>AOF和RDB比较</h3><ul>
<li>两者区别：RDB持久化是指在指定的时间间隔内将内存中的数据集快照写入磁盘，实际操作过程是fork一个子进程，先将数据集写入临时文件，写入成功后，再替换之前的文件，用二进制压缩存储。AOF持久化以日志的形式记录服务器所处理的每一个写、删除操作，查询操作不会记录，以文本的方式记录，可以打开文件看到详细的操作记录。  </li>
<li>优缺点：RDB：灵活设置备份频率和周期。方便灾难恢复，可以轻松的将一个单独的文件压缩再转移到其他存储介质上。性能最大化。数据集很大时，启动效率相对AOF较高。缺点：很难保证高可用，可能数据在写入磁盘之前会丢失。数据集较大时，可能导致服务器停止服务。<br>AOF：数据持久性。对日志的写入操作采用的是append模式，写入过程即使出现宕机，也不会破坏日志文件中已经存在的内容。如果日志过大，Redis可以自动启用rewrite机制。包含一个格式清晰、易于理解的日志文件用于记录所有的修改操作。缺点：RDB 在恢复大数据集时的速度比 AOF 的恢复速度要快。根据同步策略的不同，AOF在运行效率上往往会慢于RDB。  </li>
</ul>
<h3 id="Redis分布式锁"><a href="#Redis分布式锁" class="headerlink" title="Redis分布式锁"></a>Redis分布式锁</h3><p>使用setnx来争抢锁，抢到之后，再用expire给锁加一个过期时间防止锁忘记了释放。<br>如果在setnx之后执行expire之前进程意外crash或者要重启维护了，那会怎么样？<br>同时把setnx和expire合成一条指令来用  </p>
<h3 id="寻找key"><a href="#寻找key" class="headerlink" title="寻找key"></a>寻找key</h3><p>假如Redis里面有1亿个key，其中有10w个key是以某个固定的已知的前缀开头的，如果将它们全部找出来？<br>用keys指令可以扫出指定模式的key列表。<br>redis的单线程的。keys指令会导致线程阻塞一段时间，线上服务会停顿，直到指令执行完毕，服务才能恢复。这个时候可以使用scan指令，scan指令可以无阻塞的提取出指定模式的key列表，但是会有一定的重复概率，在客户端做一次去重就可以了，但是整体所花费的时间会比直接用keys指令长。  </p>
<h3 id="Redis同步机制"><a href="#Redis同步机制" class="headerlink" title="Redis同步机制"></a>Redis同步机制</h3><p>Redis可以使用主从同步，从从同步。第一次同步时，主节点做一次bgsave，并同时将后续修改操作记录到内存buffer，待完成后将rdb文件全量同步到复制节点，复制节点接受完成后将rdb镜像加载到内存。加载完成后，再通知主节点将期间修改的操作记录同步到复制节点进行重放就完成了同步过程。</p>
<h3 id="redis相比memcached有哪些优势"><a href="#redis相比memcached有哪些优势" class="headerlink" title="redis相比memcached有哪些优势"></a>redis相比memcached有哪些优势</h3><ol>
<li>丰富的数据类型  </li>
<li>速度快  </li>
<li>可以持久化<br>区别：  </li>
<li>存储方式：Memecache把数据全部存在内存之中，断电后会挂掉，数据不能超过内存大小。Redis有部份存在硬盘上，这样能保证数据的持久性。  </li>
<li>数据类型：Memcache对数据类型支持相对简单。Redis有复杂的数据类型,Redis不仅仅支持简单的k/v类型的数据，同时还提供list，set，zset，hash等数据结构的存储。  </li>
<li>底层模型：它们之间底层实现方式以及与客户端之间通信的应用协议不一样。Redis直接自己构建了VM 机制，因为一般的系统调用系统函数的话，会浪费一定的时间去移动和请求。  </li>
<li>value大小：redis最大可以达到1GB，而memcache只有1MB。  </li>
<li>Redis支持数据的备份，即master-slave模式的数据备份。</li>
</ol>
<h3 id="Redis的LRU算法"><a href="#Redis的LRU算法" class="headerlink" title="Redis的LRU算法"></a>Redis的LRU算法</h3><p>最近最久未用算法。当内存达到限制时，Redis 具体的回收策略是通过 maxmemory-policy 配置项配置的。<br>no-eviction：不清除数据，只是返回错误，这样会导致浪费掉更多的内存，对大多数写命令（DEL 命令和其他的少数命令例外）<br>allkeys-lru：从所有的数据集（server.db[i].dict）中挑选最近最少使用的数据淘汰，以供新数据使用<br>volatile-lru：从已设置过期时间的数据集（server.db[i].expires）中挑选最近最少使用的数据淘汰，以供新数据使用<br>allkeys-random：从所有数据集（server.db[i].dict）中任意选择数据淘汰，以供新数据使用<br>volatile-random：从已设置过期时间的数据集（server.db[i].expires）中任意选择数据淘汰，以供新数据使用<br>volatile-ttl：从已设置过期时间的数据集（server.db[i].expires）中挑选将要过期的数据淘汰，以供新数据使用  </p>
<h3 id="Redis常见的性能问题及解决"><a href="#Redis常见的性能问题及解决" class="headerlink" title="Redis常见的性能问题及解决"></a>Redis常见的性能问题及解决</h3><ol>
<li>Master最好不要做任何持久化工作，如RDB内存快照和AOF日志文件. 特别是不要启用内存快照做持久化,如果数据比较关键，某个Slave开启AOF备份数据，策略为每秒同步一次。  </li>
<li>尽量避免在压力很大的主库上增加从库。  </li>
<li>Master调用BGREWRITEAOF重写AOF文件，AOF在重写的时候会占大量的CPU和内存资源，导致服务load过高，出现短暂服务暂停现象。  </li>
<li>Redis主从复制的性能问题，为了主从复制的速度和连接的稳定性，Slave和Master最好在同一个局域网内  </li>
</ol>
<h3 id="适合Redis的场景"><a href="#适合Redis的场景" class="headerlink" title="适合Redis的场景"></a>适合Redis的场景</h3><ol>
<li>会话缓存 全页缓存   队列 排行榜/计数器  发布/订阅  会话  购物车 </li>
</ol>
<h3 id="Nosql和Key-Value数据库"><a href="#Nosql和Key-Value数据库" class="headerlink" title="Nosql和Key-Value数据库"></a>Nosql和Key-Value数据库</h3><p>NoSQL，泛指非关系型的数据库，全称Not Only SQL，意即“不仅仅是SQL”。<br>NoSQL数据库的四大家族：</p>
<ol>
<li>键值（Key-Value）数据库:Redis、Memcached   </li>
<li>面向文档（Document-Oriented）数据库:MongoDB  适用：日志、分析</li>
<li>列存储（Wide Column Store/Column-Family）数据库  HBase 适用:日志、博客平台</li>
<li>图（Graph-Oriented）数据库 适用：关系性强，推荐引擎</li>
</ol>
<h2 id="Reference："><a href="#Reference：" class="headerlink" title="Reference："></a>Reference：</h2><p><a href="https://www.bookstack.cn/read/note-of-interview/framework-redis.md" target="_blank" rel="external">https://www.bookstack.cn/read/note-of-interview/framework-redis.md</a><br><a href="http://www.techug.com/post/nosql.html" target="_blank" rel="external">http://www.techug.com/post/nosql.html</a>   </p>

      
    </div>
    
    
    

    
      <div>
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/uploads/wechat-qcode.jpg" alt="mianhk wechat" style="width: 200px; max-width: 100%;"/>
    <div>不关注一下怎么知道有多好看呢</div>
</div>

      </div>
    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>来都来了，请我喝点啥吧</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>Donate</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="mianhk WeChat Pay"/>
        <p>WeChat Pay</p>
      </div>
    

    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Linux/" rel="tag"><i class="fa fa-tag"></i> Linux</a>
          
            <a href="/tags/后台开发/" rel="tag"><i class="fa fa-tag"></i> 后台开发</a>
          
            <a href="/tags/Redis/" rel="tag"><i class="fa fa-tag"></i> Redis</a>
          
            <a href="/tags/Nosql/" rel="tag"><i class="fa fa-tag"></i> Nosql</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/24-工具/shell_自动push/" rel="next" title="ubuntu自动push到github脚本">
                <i class="fa fa-chevron-left"></i> ubuntu自动push到github脚本
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="SOHUCS"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpg"
               alt="mianhk" />
          <p class="site-author-name" itemprop="name">mianhk</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">86</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">31</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/mianhk" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://weibo.com/3024507693/profile?rightmod=1&wvr=6&mod=personinfo" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                    
                      Weibo
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              不是特别强烈的推荐
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="https://x-nicolo.github.io" title="肖洒的博客" target="_blank">肖洒的博客</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://yuanfengliu.github.io/" title="刘渊峰的博客" target="_blank">刘渊峰的博客</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#《redis-设计与实现》–总结"><span class="nav-number">1.</span> <span class="nav-text">《redis 设计与实现》–总结</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-数据结构与对象"><span class="nav-number">1.1.</span> <span class="nav-text">1.数据结构与对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-简单动态字符串"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.简单动态字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-链表"><span class="nav-number">1.1.2.</span> <span class="nav-text">2.链表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-字典"><span class="nav-number">1.1.3.</span> <span class="nav-text">3.字典</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-跳跃表"><span class="nav-number">1.1.4.</span> <span class="nav-text">4.跳跃表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-整数集合"><span class="nav-number">1.1.5.</span> <span class="nav-text">5.整数集合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-压缩列表"><span class="nav-number">1.1.6.</span> <span class="nav-text">6.压缩列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-对象"><span class="nav-number">1.1.7.</span> <span class="nav-text">7.对象</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-单机数据库的实现"><span class="nav-number">1.2.</span> <span class="nav-text">2.单机数据库的实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#数据库"><span class="nav-number">1.2.1.</span> <span class="nav-text">数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#数据库键空间"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">数据库键空间</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#设置键的生存时间或过期时间"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">设置键的生存时间或过期时间</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RDB文件结构"><span class="nav-number">1.2.1.3.</span> <span class="nav-text">RDB文件结构</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AOF持久化-Append-Only-File"><span class="nav-number">1.2.2.</span> <span class="nav-text">AOF持久化(Append Only File)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#AOF持久化的实现过程"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">AOF持久化的实现过程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#AOF重写"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">AOF重写</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#事件"><span class="nav-number">1.2.3.</span> <span class="nav-text">事件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#文件事件"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">文件事件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-多机数据库的实现"><span class="nav-number">1.3.</span> <span class="nav-text">3.多机数据库的实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-独立功能的实现"><span class="nav-number">1.4.</span> <span class="nav-text">4.独立功能的实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#常见问题"><span class="nav-number">1.5.</span> <span class="nav-text">常见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#AOF和RDB比较"><span class="nav-number">1.5.1.</span> <span class="nav-text">AOF和RDB比较</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis分布式锁"><span class="nav-number">1.5.2.</span> <span class="nav-text">Redis分布式锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#寻找key"><span class="nav-number">1.5.3.</span> <span class="nav-text">寻找key</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis同步机制"><span class="nav-number">1.5.4.</span> <span class="nav-text">Redis同步机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#redis相比memcached有哪些优势"><span class="nav-number">1.5.5.</span> <span class="nav-text">redis相比memcached有哪些优势</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis的LRU算法"><span class="nav-number">1.5.6.</span> <span class="nav-text">Redis的LRU算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis常见的性能问题及解决"><span class="nav-number">1.5.7.</span> <span class="nav-text">Redis常见的性能问题及解决</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#适合Redis的场景"><span class="nav-number">1.5.8.</span> <span class="nav-text">适合Redis的场景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Nosql和Key-Value数据库"><span class="nav-number">1.5.9.</span> <span class="nav-text">Nosql和Key-Value数据库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reference："><span class="nav-number">1.6.</span> <span class="nav-text">Reference：</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">mianhk</span>
</div>


<div class="powered-by">
  powerd by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Hosted By 
  <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
