<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="noodp">
<meta http-equiv=x-ua-compatible content="IE=edge, chrome=1">
<title>go语言学习(2)-极客时间 - mianhk's notes</title><meta name=Description content><meta property="og:title" content="go语言学习(2)-极客时间">
<meta property="og:description" content="第一个 go 程序 go 语言主函数没有返回值，需要使用 os 包， os.exit() ，也不能直接函数传参。 变量、常量和其他语言的区别 赋值可以自动类型推断： a:=1 ，怎么方便怎么来">
<meta property="og:type" content="article">
<meta property="og:url" content="http://yuguocong.cn/posts/yuque/go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A02-%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2019-04-28T21:34:33+08:00">
<meta property="article:modified_time" content="2019-04-28T21:34:33+08:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="go语言学习(2)-极客时间">
<meta name=twitter:description content="第一个 go 程序 go 语言主函数没有返回值，需要使用 os 包， os.exit() ，也不能直接函数传参。 变量、常量和其他语言的区别 赋值可以自动类型推断： a:=1 ，怎么方便怎么来">
<meta name=application-name content="LoveIt">
<meta name=apple-mobile-web-app-title content="LoveIt"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=http://yuguocong.cn/posts/yuque/go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A02-%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/><link rel=prev href=http://yuguocong.cn/posts/yuque/mysql%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%803/><link rel=next href=http://yuguocong.cn/posts/yuque/git%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"go语言学习(2)-极客时间","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/yuguocong.cn\/posts\/yuque\/go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A02-%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4\/"},"genre":"posts","keywords":"Golang","wordcount":3507,"url":"http:\/\/yuguocong.cn\/posts\/yuque\/go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A02-%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4\/","datePublished":"2019-04-28T21:34:33+08:00","dateModified":"2019-04-28T21:34:33+08:00","publisher":{"@type":"Organization","name":"mianhk"},"author":{"@type":"Person","name":"mianhk"},"description":""}</script></head>
<body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':''==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:''==='dark')&&document.body.setAttribute('theme','dark')</script>
<div id=mask></div><div class=wrapper><header class=desktop id=header-desktop>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title="mianhk's notes">mianhk's notes</a>
</div>
<div class=menu>
<div class=menu-inner><a class=menu-item href=/> 主页 </a><a class=menu-item href=/posts/> 文章 </a><a class=menu-item href=/tags/> 标签 </a><a class=menu-item href=/categories/> 分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索>
<i class="fas fa-search fa-fw"></i>
</a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空>
<i class="fas fa-times-circle fa-fw"></i>
</a>
<span class="search-button search-loading" id=search-loading-desktop>
<i class="fas fa-spinner fa-fw fa-spin"></i>
</span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i>
</a>
</div>
</div>
</div>
</header><header class=mobile id=header-mobile>
<div class=header-container>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title="mianhk's notes">mianhk's notes</a>
</div>
<div class=menu-toggle id=menu-toggle-mobile>
<span></span><span></span><span></span>
</div>
</div>
<div class=menu id=menu-mobile><div class=search-wrapper>
<div class="search mobile" id=search-mobile>
<input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索>
<i class="fas fa-search fa-fw"></i>
</a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空>
<i class="fas fa-times-circle fa-fw"></i>
</a>
<span class="search-button search-loading" id=search-loading-mobile>
<i class="fas fa-spinner fa-fw fa-spin"></i>
</span>
</div>
<a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>
取消
</a>
</div><a class=menu-item href=/ title>主页</a><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i>
</a></div>
</div>
</header>
<div class="search-dropdown desktop">
<div id=search-dropdown-desktop></div>
</div>
<div class="search-dropdown mobile">
<div id=search-dropdown-mobile></div>
</div>
<main class=main>
<div class=container><div class=toc id=toc-auto>
<h2 class=toc-title>目录</h2>
<div class=toc-content id=toc-content-auto></div>
</div><article class="page single"><h1 class="single-title animated flipInX">go语言学习(2)-极客时间</h1><div class=post-meta>
<div class=post-meta-line><span class=post-author><a href=https://github.com/mianhk title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>mianhk</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/golang/><i class="far fa-folder fa-fw"></i>Golang</a></span></div>
<div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2019-04-28>2019-04-28</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 3507 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 7 分钟&nbsp;</div>
</div><div class="details toc" id=toc-static kept>
<div class="details-summary toc-title">
<span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span>
</div>
<div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents>
<ul>
<li><a href=#数组>数组</a></li>
<li><a href=#切片>切片</a></li>
<li><a href=#切片和数组的区别>切片和数组的区别</a></li>
</ul>
<ul>
<li><a href=#unicode-和-utf-8>Unicode 和 UTF-8</a></li>
</ul>
<ul>
<li><a href=#封装数据和行为>封装数据和行为</a></li>
<li><a href=#行为方法定义>行为（方法）定义</a></li>
</ul>
<ul>
<li><a href=#duck-type>Duck Type</a></li>
<li><a href=#接口变量>接口变量</a></li>
<li><a href=#自定义类型>自定义类型</a></li>
</ul>
<ul>
<li><a href=#空接口与断言>空接口与断言</a></li>
<li><a href=#go-接口最佳实践>Go 接口最佳实践</a></li>
</ul>
<ul>
<li><a href=#panic>panic</a></li>
<li><a href=#panic-vs-osexit>panic vs os.Exit</a></li>
<li><a href=#recover>recover</a></li>
</ul>
<ul>
<li><a href=#package>package</a></li>
<li><a href=#init-方法>init 方法</a></li>
<li><a href=#go-get>go get</a></li>
</ul>
<ul>
<li><a href=#go-未解决的依赖问题>Go 未解决的依赖问题</a></li>
<li><a href=#vendor-路径>vendor 路径</a></li>
</ul>
<ul>
<li><a href=#线程-vs-协程>线程 vs 协程</a></li>
</ul>
<ul>
<li><a href=#lock>Lock</a></li>
<li><a href=#waitgroup>WaitGroup</a></li>
</ul>
<ul>
<li><a href=#csp-vs-actor>CSP vs Actor</a></li>
<li><a href=#channel>Channel</a></li>
</ul>
<ul>
<li><a href=#select>select</a></li>
</ul>
<ul>
<li><a href=#channel-的关闭>channel 的关闭</a></li>
</ul>
<ul>
<li><a href=#context>Context</a></li>
</ul>
<ul>
<li><a href=#只运行一次常见的并发任务>只运行一次（常见的并发任务）</a></li>
<li><a href=#所需任意任务完成>所需任意任务完成</a></li>
<li><a href=#所有任务完成>所有任务完成</a></li>
<li><a href=#对象池>对象池</a></li>
<li><a href=#syncpool-对象缓存>sync.pool 对象缓存</a></li>
</ul>
<ul>
<li><a href=#单元测试>单元测试</a>
<ul>
<li><a href=#内置单元测试框架>内置单元测试框架</a></li>
</ul>
</li>
<li><a href=#benchmark>Benchmark</a></li>
<li><a href=#bbd>BBD</a></li>
<li><a href=#反射编程>反射编程</a></li>
<li><a href=#万能程序>万能程序</a></li>
<li><a href=#不安全编程>不安全编程</a></li>
</ul>
<ul>
<li><a href=#pipe-filter-架构>Pipe-Filter 架构</a></li>
<li><a href=#micro-kernel>micro kernel</a></li>
<li><a href=#内置-json-解析>内置 json 解析</a></li>
<li><a href=#easyjson>easyjson</a></li>
<li><a href=#http-服务>HTTP 服务</a></li>
<li><a href=#构建-restful-服务>构建 Restful 服务</a></li>
<li><a href=#性能分析工具>性能分析工具</a></li>
</ul>
</nav></div>
</div><div class=content id=content><h1 id=第一个-go-程序>第一个 go 程序</h1>
<ul>
<li>go 语言主函数没有返回值，需要使用 os 包， <code>os.exit()</code> ，也不能直接函数传参。</li>
</ul>
<h1 id=变量常量和其他语言的区别>变量、常量和其他语言的区别</h1>
<ul>
<li>赋值可以自动类型推断： <code>a:=1</code> ，怎么方便怎么来就行</li>
<li>快速连续赋值</li>
</ul>
<pre tabindex=0><code>const (
	Monday=itoa+1
  Tuesday
  Wednesday
)

const(
	Open=1&lt;&lt;itoa
  Close
  Pending
)
</code></pre><h1 id=运算符>运算符</h1>
<ul>
<li>算数运算符：没有前置的++、&ndash;</li>
<li>比较运算符：用 <code>==</code>  比较时，相同维数的数组可以比较</li>
<li>逻辑运算符</li>
<li>位运算符： <code>&^</code> ：按位清零</li>
</ul>
<pre tabindex=0><code>1 &amp;^ 0 --1
1&amp;^ 1 --0
0&amp;^1 --0
0&amp;^0 --0
</code></pre><h1 id=条件和循环>条件和循环</h1>
<ul>
<li>循环：只支持 <code>for</code> ，并且没有括号，while 条件的写法为</li>
</ul>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=k>for</span> <span class=nx>n</span><span class=p>&lt;</span><span class=mi>5</span><span class=p>{</span>
	<span class=nx>n</span><span class=o>++</span>
  <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>n</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div><ul>
<li>条件：条件一定要是个布尔值或表达式。支持在 if 语句中对变量赋值</li>
<li>switch 条件：条件表达式不限制为常量或者整数；单个 case 中，可以出现多个结果选项，使用逗号分隔；不需要 break；可以不设定 switch 之后的条件表达式</li>
</ul>
<h1 id=数组和切片>数组和切片</h1>
<h2 id=数组>数组</h2>
<ul>
<li>数组的声明：声明同时初始化：<code>arr3:=[...]int{1,3,4,5} </code></li>
<li>数组的遍历</li>
<li>数组截取：a[index_begin(包含),index_end(不包含)]</li>
</ul>
<h2 id=切片>切片</h2>
<ul>
<li>切片的声明方式：与数组的声明有点相似</li>
</ul>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=kd>var</span> <span class=nx>s0</span> <span class=p>[]</span><span class=kt>int</span>
<span class=nx>s1</span><span class=o>:=</span><span class=p>[]</span><span class=kt>int</span><span class=p>{}</span>
<span class=nx>s2</span><span class=o>:=</span><span class=p>[]</span><span class=kt>int</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>}</span>
<span class=nx>s2</span><span class=o>:=</span><span class=nb>make</span><span class=p>([]</span><span class=kt>int</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>4</span><span class=p>)</span>  <span class=c1>//([]type,len,cap)  len个元素会被初始化为零值，
</span><span class=c1></span>                       <span class=nx>cap中其它未初始化的元素不能访问</span>
</code></pre></div><ul>
<li>切片的增长方式：类似于 c++的 vector。</li>
<li>切片共享存储结构：切片截取后，计算 cap 得到的结果。其实切片截取，指向的是内部共享的切片存储空间。所以修改截取的切片的数据，其他截取的相同区域也会发生改变。这是一个容易出错的问题。</li>
</ul>
<h2 id=切片和数组的区别>切片和数组的区别</h2>
<ul>
<li>容量是否可伸缩</li>
<li>是否可以进行比较</li>
</ul>
<h1 id=map-基础>Map 基础</h1>
<ul>
<li>Map 声明方式</li>
</ul>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=nx>m</span><span class=o>:=</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=s>&#34;one&#34;</span><span class=p>:</span><span class=mi>1</span><span class=p>,</span><span class=s>&#34;two&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=s>&#34;three&#34;</span><span class=p>:</span><span class=mi>3</span><span class=p>}</span>
<span class=nx>m1</span><span class=o>:=</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>int</span><span class=p>{}</span>
<span class=nx>m1</span><span class=p>[</span><span class=s>&#34;one&#34;</span><span class=p>]=</span><span class=mi>1</span>
<span class=nx>m2</span><span class=o>:=</span><span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>int</span><span class=p>,</span><span class=mi>10</span><span class=p>)</span>  <span class=c1>//10表示初始化的cap,不需要初始化len
</span></code></pre></div><ul>
<li>元素访问：当访问的 key 不存在时，仍然会返回零值，编程时需要根据 nil 来判断元素是否存在</li>
</ul>
<h1 id=map-与工厂模式>Map 与工厂模式</h1>
<ul>
<li>Map 的 value 可以是一个方法</li>
<li>与 Go 的 Dock type 接口方式一起，可以方便的实现单一方法对象的工厂模式</li>
<li>Go 内置集合中没有 Set，可以通过 map 实现<code>mySet:=**map**[int]bool{}</code></li>
</ul>
<h1 id=字符串>字符串</h1>
<ul>
<li>string 是数据类型，不是引用或指针类型。零值不是空，而是空字符串。</li>
<li>string 是只读的 byte slice，不能重复赋值。len 函数可以表示它所包含的 byte 数</li>
<li>string 的 byte 数组可以存放任何数据</li>
</ul>
<h2 id=unicode-和-utf-8>Unicode 和 UTF-8</h2>
<ul>
<li>Unicode 是一种字符集（code point）</li>
<li>UTF-8 是 Unicode 的存储实现（转换为）</li>
</ul>
<p><img class=lazyload src=/svg/loading.min.svg data-src="https://cdn.nlark.com/yuque/0/2019/png/187932/1556503870325-262231e2-8b69-42ab-8711-83d68d74069e.png#align=left&display=inline&height=270&name=image.png&originHeight=398&originWidth=671&size=46907&status=done&width=456" data-srcset="https://cdn.nlark.com/yuque/0/2019/png/187932/1556503870325-262231e2-8b69-42ab-8711-83d68d74069e.png#align=left&display=inline&height=270&name=image.png&originHeight=398&originWidth=671&size=46907&status=done&width=456, https://cdn.nlark.com/yuque/0/2019/png/187932/1556503870325-262231e2-8b69-42ab-8711-83d68d74069e.png#align=left&display=inline&height=270&name=image.png&originHeight=398&originWidth=671&size=46907&status=done&width=456 1.5x, https://cdn.nlark.com/yuque/0/2019/png/187932/1556503870325-262231e2-8b69-42ab-8711-83d68d74069e.png#align=left&display=inline&height=270&name=image.png&originHeight=398&originWidth=671&size=46907&status=done&width=456 2x" data-sizes=auto alt="https://cdn.nlark.com/yuque/0/2019/png/187932/1556503870325-262231e2-8b69-42ab-8711-83d68d74069e.png#align=left&display=inline&height=270&name=image.png&originHeight=398&originWidth=671&size=46907&status=done&width=456" title=image.png></p>
<h1 id=go-语言的函数>Go 语言的函数</h1>
<ul>
<li>函数可以返回多个值</li>
<li>所有参数都是值传递：slice，map，channel 会有传引用的错觉</li>
<li>函数可以作为变量的值</li>
<li>函数可以作为参数和返回值</li>
</ul>
<h1 id=可变参数及-defer>可变参数及 defer</h1>
<ul>
<li>延迟执行函数：defer。类似于其他语言中的 finally，主要作用是最后关闭一些资源或者关闭一些锁</li>
</ul>
<h1 id=行为的定义和实现>行为的定义和实现</h1>
<h2 id=封装数据和行为>封装数据和行为</h2>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=kd>type</span> <span class=nx>Employee</span> <span class=kd>struct</span><span class=p>{</span>
	<span class=nx>Id</span> <span class=kt>string</span>
  <span class=nx>Name</span> <span class=kt>string</span>
  <span class=nx>Age</span> <span class=kt>int</span>
<span class=p>}</span>
<span class=nx>实例的创建和初始化</span>
<span class=nx>e</span><span class=o>:=</span><span class=nx>Employee</span><span class=p>{</span><span class=s>&#34;0&#34;</span><span class=p>,</span><span class=s>&#34;Bob&#34;</span><span class=p>,</span><span class=mi>20</span><span class=p>}</span>
<span class=nx>e1</span><span class=o>:=</span><span class=nx>Employee</span><span class=p>{</span><span class=nx>Name</span><span class=p>:</span><span class=s>&#34;Mike&#34;</span><span class=p>,</span><span class=nx>Age</span><span class=p>:</span><span class=mi>30</span><span class=p>}</span>
<span class=nx>e2</span><span class=o>:=</span><span class=nb>new</span><span class=p>(</span><span class=nx>Employee</span><span class=p>)</span>  <span class=c1>//这里返回的是实例的指针
</span><span class=c1></span><span class=nx>e2</span><span class=p>.</span><span class=nx>Id</span><span class=p>=</span><span class=s>&#34;2&#34;</span>  <span class=c1>//通过实例的指针访问指针不需要“-&gt;”
</span></code></pre></div><h2 id=行为方法定义>行为（方法）定义</h2>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=nx>Employee</span><span class=p>)</span><span class=nf>String1</span><span class=p>()</span> <span class=kt>string</span><span class=p>{</span>
	<span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;ID:%s-Name:%s-Age:%d&#34;</span><span class=p>,</span><span class=nx>e</span><span class=p>.</span><span class=nx>Id</span><span class=p>,</span><span class=nx>e</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span><span class=nx>e</span><span class=p>.</span><span class=nx>Age</span><span class=p>)</span>
<span class=p>}</span>

<span class=c1>//推荐使用的方式，类似于c++的引用
</span><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Employee</span><span class=p>)</span><span class=nf>String</span><span class=p>()</span> <span class=kt>string</span><span class=p>{</span>
	<span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;ID:%s-Name:%s-Age:%d&#34;</span><span class=p>,</span><span class=nx>e</span><span class=p>.</span><span class=nx>Id</span><span class=p>,</span><span class=nx>e</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span><span class=nx>e</span><span class=p>.</span><span class=nx>Age</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div><h1 id=go-语言的相关接口>Go 语言的相关接口</h1>
<h2 id=duck-type>Duck Type</h2>
<p>方法签名是一样的，就认为是这样的</p>
<ul>
<li>接口是非入侵性的，实现不依赖于接口定义</li>
<li>接口的定义可以包含在接口使用者包内</li>
</ul>
<h2 id=接口变量>接口变量</h2>
<p><img class=lazyload src=/svg/loading.min.svg data-src="https://cdn.nlark.com/yuque/0/2019/png/187932/1556508509894-85f1967f-80e0-4a9e-9db7-a2b01ba96f30.png#align=left&display=inline&height=338&name=image.png&originHeight=338&originWidth=701&size=40266&status=done&width=701" data-srcset="https://cdn.nlark.com/yuque/0/2019/png/187932/1556508509894-85f1967f-80e0-4a9e-9db7-a2b01ba96f30.png#align=left&display=inline&height=338&name=image.png&originHeight=338&originWidth=701&size=40266&status=done&width=701, https://cdn.nlark.com/yuque/0/2019/png/187932/1556508509894-85f1967f-80e0-4a9e-9db7-a2b01ba96f30.png#align=left&display=inline&height=338&name=image.png&originHeight=338&originWidth=701&size=40266&status=done&width=701 1.5x, https://cdn.nlark.com/yuque/0/2019/png/187932/1556508509894-85f1967f-80e0-4a9e-9db7-a2b01ba96f30.png#align=left&display=inline&height=338&name=image.png&originHeight=338&originWidth=701&size=40266&status=done&width=701 2x" data-sizes=auto alt="https://cdn.nlark.com/yuque/0/2019/png/187932/1556508509894-85f1967f-80e0-4a9e-9db7-a2b01ba96f30.png#align=left&display=inline&height=338&name=image.png&originHeight=338&originWidth=701&size=40266&status=done&width=701" title=image.png></p>
<h2 id=自定义类型>自定义类型</h2>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=kd>type</span> <span class=nx>IntConv</span> <span class=kd>func</span> <span class=p>(</span><span class=nx>op</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>int</span>
</code></pre></div><h1 id=扩展与复用>扩展与复用</h1>
<h1 id=不一样的接口类型一样的多态>不一样的接口类型，一样的多态</h1>
<h2 id=空接口与断言>空接口与断言</h2>
<ul>
<li>空接口可以表示任何类型</li>
<li>通过断言来将空接口转换为制定类型 <code>v,ok:=p.(int) //ok=true时为转换成功</code></li>
</ul>
<h2 id=go-接口最佳实践>Go 接口最佳实践</h2>
<ul>
<li>倾向于使用小的接口定义，很多接口只包含一个方法。实现的负担较小。</li>
</ul>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=nx>Type</span> <span class=nx>Reader</span> <span class=kd>interface</span><span class=p>{</span>
	<span class=nf>Read</span><span class=p>(</span><span class=nx>p</span> <span class=p>[]</span><span class=kt>byte</span><span class=p>)(</span><span class=nx>n</span> <span class=kt>int</span><span class=p>,</span><span class=nx>err</span> <span class=kt>error</span><span class=p>)</span>
<span class=p>}</span>
<span class=nx>Type</span> <span class=nx>Writer</span> <span class=kd>interface</span><span class=p>{</span>
	<span class=nf>Write</span><span class=p>(</span><span class=nx>p</span> <span class=p>[]</span><span class=kt>byte</span><span class=p>)(</span><span class=nx>n</span> <span class=kt>int</span><span class=p>,</span><span class=nx>err</span> <span class=kt>error</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div><ul>
<li>较大的接口定义，可以由多个小接口定义组合而成。</li>
</ul>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=nx>Type</span> <span class=nx>ReadWrite</span> <span class=kd>interface</span><span class=p>{</span>
	<span class=nx>Reader</span>
  <span class=nx>Writer</span>
<span class=p>}</span>
</code></pre></div><ul>
<li>只依赖于必要功能的最小接口，方法才能更多的被复用</li>
</ul>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=kd>func</span> <span class=nf>StoreData</span><span class=p>(</span><span class=nx>reader</span> <span class=nx>Reader</span><span class=p>)</span> <span class=kt>error</span><span class=p>{}</span>
</code></pre></div><h1 id=编写好的错误处理>编写好的错误处理</h1>
<ul>
<li>没有异常机制</li>
<li>error 类型实现了 error 接口</li>
<li>可以通过 errors.New 来快速创建错误实例</li>
</ul>
<h1 id=panic-和-recover>panic 和 recover</h1>
<h2 id=panic>panic</h2>
<ul>
<li>panic 用于不可恢复的错误</li>
<li>panic 退出前会执行 defer 指定的内容</li>
</ul>
<h2 id=panic-vs-osexit>panic vs os.Exit</h2>
<ul>
<li>os.Exit 退出时不会调用 defer 指定的函数</li>
<li>os.Exit 退出时不会输出当前调用栈信息</li>
</ul>
<h2 id=recover>recover</h2>
<pre tabindex=0><code>defer func(){
	if err:=recover();err!=nil{
  	//恢复错误
  }
}()
</code></pre><ul>
<li>不要强制恢复错误，有的时候“Let it crash”可能更好，让程序重启来恢复。</li>
</ul>
<h1 id=构建可复用的模块包>构建可复用的模块（包）</h1>
<h2 id=package>package</h2>
<ul>
<li>基本复用模块单元：以<strong>首字母大写</strong>来表名可被包外代码访问</li>
<li>代码在 package 可以和所在的目录了不一致（相对于 Java 而言）</li>
<li>同一目录里的 Go 代码的 package 要保持一致</li>
</ul>
<h2 id=init-方法>init 方法</h2>
<ul>
<li>在 main 被执行前，所有依赖的 package 的 init 方法都会被执行</li>
<li>不同包的 init 函数按照包导入的依赖关系决定执行顺序</li>
<li>每个包可以有多个 init 函数</li>
<li>包的每个源文件也可以有多个 init 函数，比较特殊</li>
</ul>
<h2 id=go-get>go get</h2>
<ul>
<li>通过 go get 来获取远程依赖</li>
</ul>
<pre tabindex=0><code>go get -u 强制从网络更新远程依赖
</code></pre><ul>
<li>注意代码在 Github 上的组织形式，以适应 go get：直接以代码路径开始，不要有 src</li>
</ul>
<h1 id=依赖管理>依赖管理</h1>
<h2 id=go-未解决的依赖问题>Go 未解决的依赖问题</h2>
<ul>
<li>同一环境下，不同项目使用同一包的不同版本</li>
<li>无法管理对包的特定版本的依赖</li>
</ul>
<h2 id=vendor-路径>vendor 路径</h2>
<p>Go1.5 release 版本，vendor 目录被添加到除了 GOPATH 和 GOROOT 以外的依赖目录查找方案。查找依赖包路径的解决方案：</p>
<ol>
<li>当前包下的 vendor 目录</li>
<li>向上级目录查找，直到找到 src 下的 vendor 目录</li>
<li>在 GOPATH 下面查找依赖包</li>
<li>在 GOROOT 目录下查找</li>
</ol>
<p>其他第三方依赖管理工具：godep，glide，<strong>dep</strong>
**</p>
<h1 id=协程机制>协程机制</h1>
<h2 id=线程-vs-协程>线程 vs 协程</h2>
<ul>
<li>创建时默认的 stack 大小：JAVA 1M vs Goroutine 2K</li>
<li>和 KSE（Kernel Space Entity）：java Thread 是 1:1；GO M:N</li>
</ul>
<p><img class=lazyload src=/svg/loading.min.svg data-src="https://cdn.nlark.com/yuque/0/2019/png/187932/1556704202218-7913c997-6b91-48e2-9dc6-49b057a39342.png#align=left&display=inline&height=432&name=image.png&originHeight=432&originWidth=618&size=110172&status=done&width=618" data-srcset="https://cdn.nlark.com/yuque/0/2019/png/187932/1556704202218-7913c997-6b91-48e2-9dc6-49b057a39342.png#align=left&display=inline&height=432&name=image.png&originHeight=432&originWidth=618&size=110172&status=done&width=618, https://cdn.nlark.com/yuque/0/2019/png/187932/1556704202218-7913c997-6b91-48e2-9dc6-49b057a39342.png#align=left&display=inline&height=432&name=image.png&originHeight=432&originWidth=618&size=110172&status=done&width=618 1.5x, https://cdn.nlark.com/yuque/0/2019/png/187932/1556704202218-7913c997-6b91-48e2-9dc6-49b057a39342.png#align=left&display=inline&height=432&name=image.png&originHeight=432&originWidth=618&size=110172&status=done&width=618 2x" data-sizes=auto alt="https://cdn.nlark.com/yuque/0/2019/png/187932/1556704202218-7913c997-6b91-48e2-9dc6-49b057a39342.png#align=left&display=inline&height=432&name=image.png&originHeight=432&originWidth=618&size=110172&status=done&width=618" title=image.png></p>
<h1 id=共享内存并发机制>共享内存并发机制</h1>
<h2 id=lock>Lock</h2>
<h2 id=waitgroup>WaitGroup</h2>
<p>相当于 Java 的 join</p>
<h1 id=csp-并发机制>CSP 并发机制</h1>
<h2 id=csp-vs-actor>CSP vs Actor</h2>
<ul>
<li>和 Actor 的直接通讯不同，CSP 模式是通过 Channel 进行通讯的，更松耦合一些</li>
<li>Go 中 Channel 是有容量限制并且独立于处理 Goroutine，而如 Erlang，Actor 模式中的 mailbox 容量是无限的，接收进程也总是被动地处理消息。</li>
</ul>
<h2 id=channel>Channel</h2>
<p><img class=lazyload src=/svg/loading.min.svg data-src="https://cdn.nlark.com/yuque/0/2019/png/187932/1556705599268-5d3769a6-8c93-4827-a9c2-525810d0cc3a.png#align=left&display=inline&height=910&name=image.png&originHeight=910&originWidth=1703&size=565338&status=done&width=1703" data-srcset="https://cdn.nlark.com/yuque/0/2019/png/187932/1556705599268-5d3769a6-8c93-4827-a9c2-525810d0cc3a.png#align=left&display=inline&height=910&name=image.png&originHeight=910&originWidth=1703&size=565338&status=done&width=1703, https://cdn.nlark.com/yuque/0/2019/png/187932/1556705599268-5d3769a6-8c93-4827-a9c2-525810d0cc3a.png#align=left&display=inline&height=910&name=image.png&originHeight=910&originWidth=1703&size=565338&status=done&width=1703 1.5x, https://cdn.nlark.com/yuque/0/2019/png/187932/1556705599268-5d3769a6-8c93-4827-a9c2-525810d0cc3a.png#align=left&display=inline&height=910&name=image.png&originHeight=910&originWidth=1703&size=565338&status=done&width=1703 2x" data-sizes=auto alt="https://cdn.nlark.com/yuque/0/2019/png/187932/1556705599268-5d3769a6-8c93-4827-a9c2-525810d0cc3a.png#align=left&display=inline&height=910&name=image.png&originHeight=910&originWidth=1703&size=565338&status=done&width=1703" title=image.png>
两种情况：一种是一直等待，一种 Buffered Channel ，更松耦合的 Channel，消息发送方可以在容量没满的时候一直放，满了之后需要等待。对于接收方来说，只要 Channel 内有消息就可以一直接收。</p>
<h1 id=多路选择和超时>多路选择和超时</h1>
<h2 id=select>select</h2>
<p><img class=lazyload src=/svg/loading.min.svg data-src="https://cdn.nlark.com/yuque/0/2019/png/187932/1556712290363-e32d5fa7-eb01-4d32-8fed-14ae04a0042d.png#align=left&display=inline&height=301&name=image.png&originHeight=301&originWidth=861&size=79632&status=done&width=861" data-srcset="https://cdn.nlark.com/yuque/0/2019/png/187932/1556712290363-e32d5fa7-eb01-4d32-8fed-14ae04a0042d.png#align=left&display=inline&height=301&name=image.png&originHeight=301&originWidth=861&size=79632&status=done&width=861, https://cdn.nlark.com/yuque/0/2019/png/187932/1556712290363-e32d5fa7-eb01-4d32-8fed-14ae04a0042d.png#align=left&display=inline&height=301&name=image.png&originHeight=301&originWidth=861&size=79632&status=done&width=861 1.5x, https://cdn.nlark.com/yuque/0/2019/png/187932/1556712290363-e32d5fa7-eb01-4d32-8fed-14ae04a0042d.png#align=left&display=inline&height=301&name=image.png&originHeight=301&originWidth=861&size=79632&status=done&width=861 2x" data-sizes=auto alt="https://cdn.nlark.com/yuque/0/2019/png/187932/1556712290363-e32d5fa7-eb01-4d32-8fed-14ae04a0042d.png#align=left&display=inline&height=301&name=image.png&originHeight=301&originWidth=861&size=79632&status=done&width=861" title=image.png>
运行到 select 时，当任一个事件准备好了，就可以对应响应。当不想一直等待某事件时，可以进行超时控制。</p>
<h1 id=channel-的关闭和广播>channel 的关闭和广播</h1>
<p>解决怎么知道 channel 数据完了的问题</p>
<h2 id=channel-的关闭>channel 的关闭</h2>
<ul>
<li>向关闭的 channel 发送数据，会导致 panic</li>
<li>v,ok&lt;-ch；ok 为 bool 值，true 表示正常接收，false 表示通道关闭</li>
<li>所有的 channel 接收者都会在 channel 关闭时，立即从阻塞等待中返回且上述 ok 值为 false。这个广播机制常被利用，进行向多个订阅者发送信号，如：退出信号。</li>
</ul>
<h1 id=任务的取消>任务的取消</h1>
<h1 id=context-与任务取消>Context 与任务取消</h1>
<p><img class=lazyload src=/svg/loading.min.svg data-src="https://cdn.nlark.com/yuque/0/2019/png/187932/1557062963366-c9338325-f390-4dce-ae1d-f0874f9612ba.png#align=left&display=inline&height=372&name=image.png&originHeight=298&originWidth=786&size=58395&status=done&width=982.4999853596094" data-srcset="https://cdn.nlark.com/yuque/0/2019/png/187932/1557062963366-c9338325-f390-4dce-ae1d-f0874f9612ba.png#align=left&display=inline&height=372&name=image.png&originHeight=298&originWidth=786&size=58395&status=done&width=982.4999853596094, https://cdn.nlark.com/yuque/0/2019/png/187932/1557062963366-c9338325-f390-4dce-ae1d-f0874f9612ba.png#align=left&display=inline&height=372&name=image.png&originHeight=298&originWidth=786&size=58395&status=done&width=982.4999853596094 1.5x, https://cdn.nlark.com/yuque/0/2019/png/187932/1557062963366-c9338325-f390-4dce-ae1d-f0874f9612ba.png#align=left&display=inline&height=372&name=image.png&originHeight=298&originWidth=786&size=58395&status=done&width=982.4999853596094 2x" data-sizes=auto alt="https://cdn.nlark.com/yuque/0/2019/png/187932/1557062963366-c9338325-f390-4dce-ae1d-f0874f9612ba.png#align=left&display=inline&height=372&name=image.png&originHeight=298&originWidth=786&size=58395&status=done&width=982.4999853596094" title=image.png></p>
<h2 id=context>Context</h2>
<ul>
<li>根 Context：通过 context.Background()创建</li>
<li>子 Context：context.WithCancel(parentContext)创建</li>
<li>ctx,cancel：context.WithCancel(context.Background())</li>
<li>当前 Context 被取消时，基于他的子 context 也会被取消</li>
<li>接收取消通知&lt;-ctx.Done()</li>
</ul>
<p>还有一些其他的方法</p>
<h1 id=典型并发任务>典型并发任务</h1>
<h2 id=只运行一次常见的并发任务>只运行一次（常见的并发任务）</h2>
<p>在常见的多任务环境下，只执行一次。单例模式（懒汉式，线程安全）</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=kd>type</span> <span class=nx>Singleton</span> <span class=kd>struct</span> <span class=p>{</span>

<span class=p>}</span>

<span class=kd>var</span> <span class=nx>singleInstance</span> <span class=o>*</span><span class=nx>Singleton</span>
<span class=kd>var</span> <span class=nx>once</span> <span class=nx>sync</span><span class=p>.</span><span class=nx>Once</span>

<span class=kd>func</span> <span class=nf>GetSingletonObj</span><span class=p>()</span> <span class=o>*</span><span class=nx>Singleton</span><span class=p>{</span>
	<span class=nx>once</span><span class=p>.</span><span class=nf>Do</span><span class=p>(</span><span class=kd>func</span><span class=p>()</span> <span class=p>{</span>    <span class=c1>//传入创建方法
</span><span class=c1></span>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Create Obj&#34;</span><span class=p>)</span>
		<span class=nx>singleInstance</span><span class=p>=</span><span class=nb>new</span><span class=p>(</span><span class=nx>Singleton</span><span class=p>)</span>
	<span class=p>})</span>
	<span class=k>return</span> <span class=nx>singleInstance</span>
<span class=p>}</span>

</code></pre></div><h2 id=所需任意任务完成>所需任意任务完成</h2>
<h2 id=所有任务完成>所有任务完成</h2>
<h2 id=对象池>对象池</h2>
<p>数据库连接，网络连接，经常将这些对象池化，避免重复创建。</p>
<h2 id=syncpool-对象缓存>sync.pool 对象缓存</h2>
<p>从名字来看，像是 go 语言提供的池。其实是对象的缓存
<img class=lazyload src=/svg/loading.min.svg data-src="https://cdn.nlark.com/yuque/0/2019/png/187932/1557066107461-3144bf63-f63c-4522-b25d-af4bd721daab.png#align=left&display=inline&height=517&name=image.png&originHeight=414&originWidth=846&size=118933&status=done&width=1057.4999842420223" data-srcset="https://cdn.nlark.com/yuque/0/2019/png/187932/1557066107461-3144bf63-f63c-4522-b25d-af4bd721daab.png#align=left&display=inline&height=517&name=image.png&originHeight=414&originWidth=846&size=118933&status=done&width=1057.4999842420223, https://cdn.nlark.com/yuque/0/2019/png/187932/1557066107461-3144bf63-f63c-4522-b25d-af4bd721daab.png#align=left&display=inline&height=517&name=image.png&originHeight=414&originWidth=846&size=118933&status=done&width=1057.4999842420223 1.5x, https://cdn.nlark.com/yuque/0/2019/png/187932/1557066107461-3144bf63-f63c-4522-b25d-af4bd721daab.png#align=left&display=inline&height=517&name=image.png&originHeight=414&originWidth=846&size=118933&status=done&width=1057.4999842420223 2x" data-sizes=auto alt="https://cdn.nlark.com/yuque/0/2019/png/187932/1557066107461-3144bf63-f63c-4522-b25d-af4bd721daab.png#align=left&display=inline&height=517&name=image.png&originHeight=414&originWidth=846&size=118933&status=done&width=1057.4999842420223" title=image.png></p>
<ul>
<li>如果私有对象不存在则保存为私有对象</li>
<li>如果私有对象存在，就放入当前 Processor 子池的共享池中</li>
</ul>
<p>使用：
<img class=lazyload src=/svg/loading.min.svg data-src="https://cdn.nlark.com/yuque/0/2019/png/187932/1557066277648-e57411da-71d5-4673-93bc-a82e0315284b.png#align=left&display=inline&height=341&name=image.png&originHeight=273&originWidth=497&size=37422&status=done&width=621.2499907426537" data-srcset="https://cdn.nlark.com/yuque/0/2019/png/187932/1557066277648-e57411da-71d5-4673-93bc-a82e0315284b.png#align=left&display=inline&height=341&name=image.png&originHeight=273&originWidth=497&size=37422&status=done&width=621.2499907426537, https://cdn.nlark.com/yuque/0/2019/png/187932/1557066277648-e57411da-71d5-4673-93bc-a82e0315284b.png#align=left&display=inline&height=341&name=image.png&originHeight=273&originWidth=497&size=37422&status=done&width=621.2499907426537 1.5x, https://cdn.nlark.com/yuque/0/2019/png/187932/1557066277648-e57411da-71d5-4673-93bc-a82e0315284b.png#align=left&display=inline&height=341&name=image.png&originHeight=273&originWidth=497&size=37422&status=done&width=621.2499907426537 2x" data-sizes=auto alt="https://cdn.nlark.com/yuque/0/2019/png/187932/1557066277648-e57411da-71d5-4673-93bc-a82e0315284b.png#align=left&display=inline&height=341&name=image.png&originHeight=273&originWidth=497&size=37422&status=done&width=621.2499907426537" title=image.png></p>
<p>**sync.pool 对象的生命周期&mdash;**sync.pool 不能作为对象池的原因</p>
<ul>
<li>GC 会清除 sync.pool 缓存的对象</li>
<li>sync.pool 对象的缓存有效期为下一次 GC 之前</li>
</ul>
<p>总结：</p>
<ul>
<li>适合于通过复用，降低复杂对象的创建和 GC 代价</li>
<li>协程安全，会有锁的开销</li>
<li>声明周期受 GC 影响，不适合于做连接池等，需自己管理生命周期资源的池化</li>
<li>所以具体要看锁的开销大，还是初始化的开销大</li>
</ul>
<h1 id=测试>测试</h1>
<h2 id=单元测试>单元测试</h2>
<p>表格测试</p>
<h3 id=内置单元测试框架>内置单元测试框架</h3>
<ul>
<li>Fail，Error：该测试失败，该测试继续，其他测试继续执行</li>
<li>FailNow，Fatal：该测试失败，该测试中止，其他测试继续执行</li>
</ul>
<p>代码覆盖率</p>
<h2 id=benchmark>Benchmark</h2>
<p><img class=lazyload src=/svg/loading.min.svg data-src="https://cdn.nlark.com/yuque/0/2019/png/187932/1557067837101-3bdadb6b-821f-4dbd-9b3a-c9efe304bc7a.png#align=left&display=inline&height=491&name=image.png&originHeight=393&originWidth=679&size=77590&status=done&width=848.7499873526397" data-srcset="https://cdn.nlark.com/yuque/0/2019/png/187932/1557067837101-3bdadb6b-821f-4dbd-9b3a-c9efe304bc7a.png#align=left&display=inline&height=491&name=image.png&originHeight=393&originWidth=679&size=77590&status=done&width=848.7499873526397, https://cdn.nlark.com/yuque/0/2019/png/187932/1557067837101-3bdadb6b-821f-4dbd-9b3a-c9efe304bc7a.png#align=left&display=inline&height=491&name=image.png&originHeight=393&originWidth=679&size=77590&status=done&width=848.7499873526397 1.5x, https://cdn.nlark.com/yuque/0/2019/png/187932/1557067837101-3bdadb6b-821f-4dbd-9b3a-c9efe304bc7a.png#align=left&display=inline&height=491&name=image.png&originHeight=393&originWidth=679&size=77590&status=done&width=848.7499873526397 2x" data-sizes=auto alt="https://cdn.nlark.com/yuque/0/2019/png/187932/1557067837101-3bdadb6b-821f-4dbd-9b3a-c9efe304bc7a.png#align=left&display=inline&height=491&name=image.png&originHeight=393&originWidth=679&size=77590&status=done&width=848.7499873526397" title=image.png>
以 Benchmark 开头，参数类型稍有不同。
通过 ResetTimer 和 StopTimer 将测试代码隔开</p>
<p>命令行下运行：</p>
<h2 id=bbd>BBD</h2>
<p>Behavior Driven Development
常用框架：goconvey</p>
<h2 id=反射编程>反射编程</h2>
<p><img class=lazyload src=/svg/loading.min.svg data-src="https://cdn.nlark.com/yuque/0/2019/png/187932/1557107233067-f50d5086-e384-46cc-bd5e-0a2446ec3d8f.png#align=left&display=inline&height=390&name=image.png&originHeight=312&originWidth=820&size=64732&status=done&width=1024.99998472631" data-srcset="https://cdn.nlark.com/yuque/0/2019/png/187932/1557107233067-f50d5086-e384-46cc-bd5e-0a2446ec3d8f.png#align=left&display=inline&height=390&name=image.png&originHeight=312&originWidth=820&size=64732&status=done&width=1024.99998472631, https://cdn.nlark.com/yuque/0/2019/png/187932/1557107233067-f50d5086-e384-46cc-bd5e-0a2446ec3d8f.png#align=left&display=inline&height=390&name=image.png&originHeight=312&originWidth=820&size=64732&status=done&width=1024.99998472631 1.5x, https://cdn.nlark.com/yuque/0/2019/png/187932/1557107233067-f50d5086-e384-46cc-bd5e-0a2446ec3d8f.png#align=left&display=inline&height=390&name=image.png&originHeight=312&originWidth=820&size=64732&status=done&width=1024.99998472631 2x" data-sizes=auto alt="https://cdn.nlark.com/yuque/0/2019/png/187932/1557107233067-f50d5086-e384-46cc-bd5e-0a2446ec3d8f.png#align=left&display=inline&height=390&name=image.png&originHeight=312&originWidth=820&size=64732&status=done&width=1024.99998472631" title=image.png></p>
<p><img class=lazyload src=/svg/loading.min.svg data-src="https://cdn.nlark.com/yuque/0/2019/png/187932/1557107389241-fb6b5237-7e73-48e9-83a9-e6c6ae45f6aa.png#align=left&display=inline&height=356&name=image.png&originHeight=285&originWidth=755&size=35453&status=done&width=943.7499859370294" data-srcset="https://cdn.nlark.com/yuque/0/2019/png/187932/1557107389241-fb6b5237-7e73-48e9-83a9-e6c6ae45f6aa.png#align=left&display=inline&height=356&name=image.png&originHeight=285&originWidth=755&size=35453&status=done&width=943.7499859370294, https://cdn.nlark.com/yuque/0/2019/png/187932/1557107389241-fb6b5237-7e73-48e9-83a9-e6c6ae45f6aa.png#align=left&display=inline&height=356&name=image.png&originHeight=285&originWidth=755&size=35453&status=done&width=943.7499859370294 1.5x, https://cdn.nlark.com/yuque/0/2019/png/187932/1557107389241-fb6b5237-7e73-48e9-83a9-e6c6ae45f6aa.png#align=left&display=inline&height=356&name=image.png&originHeight=285&originWidth=755&size=35453&status=done&width=943.7499859370294 2x" data-sizes=auto alt="https://cdn.nlark.com/yuque/0/2019/png/187932/1557107389241-fb6b5237-7e73-48e9-83a9-e6c6ae45f6aa.png#align=left&display=inline&height=356&name=image.png&originHeight=285&originWidth=755&size=35453&status=done&width=943.7499859370294" title=image.png></p>
<h2 id=万能程序>万能程序</h2>
<p>DeepEqual
比较切片和 map
与配置相关的，要求灵活性和复用性时，可以
反射的</p>
<h2 id=不安全编程>不安全编程</h2>
<p>unsafe，一般涉及到库的交互，与 c 语言交互。
“不安全”行为危险性：Go 语言中不支持强制类型转换。下列操作看似可以，实际不能转换，而且实际使用起来很危险。</p>
<pre tabindex=0><code>i:=10
f:=*(*floa64)(unsafe.Pointer(&amp;i))
</code></pre><p>场景 2：用到内置的 Atomic 操作，指针原子操作，并发读写</p>
<h1 id=架构模式>架构模式</h1>
<h2 id=pipe-filter-架构>Pipe-Filter 架构</h2>
<p><img class=lazyload src=/svg/loading.min.svg data-src="https://cdn.nlark.com/yuque/0/2019/png/187932/1557108759332-46d3b8e2-5573-419b-80b6-63cfbf5feaa1.png#align=left&display=inline&height=510&name=image.png&originHeight=408&originWidth=782&size=86362&status=done&width=977.4999854341152" data-srcset="https://cdn.nlark.com/yuque/0/2019/png/187932/1557108759332-46d3b8e2-5573-419b-80b6-63cfbf5feaa1.png#align=left&display=inline&height=510&name=image.png&originHeight=408&originWidth=782&size=86362&status=done&width=977.4999854341152, https://cdn.nlark.com/yuque/0/2019/png/187932/1557108759332-46d3b8e2-5573-419b-80b6-63cfbf5feaa1.png#align=left&display=inline&height=510&name=image.png&originHeight=408&originWidth=782&size=86362&status=done&width=977.4999854341152 1.5x, https://cdn.nlark.com/yuque/0/2019/png/187932/1557108759332-46d3b8e2-5573-419b-80b6-63cfbf5feaa1.png#align=left&display=inline&height=510&name=image.png&originHeight=408&originWidth=782&size=86362&status=done&width=977.4999854341152 2x" data-sizes=auto alt="https://cdn.nlark.com/yuque/0/2019/png/187932/1557108759332-46d3b8e2-5573-419b-80b6-63cfbf5feaa1.png#align=left&display=inline&height=510&name=image.png&originHeight=408&originWidth=782&size=86362&status=done&width=977.4999854341152" title=image.png></p>
<ul>
<li>非常适合与数据处理及数据分析系统<img class=lazyload src=/svg/loading.min.svg data-src="https://cdn.nlark.com/yuque/0/2019/png/187932/1557108843135-278143cd-9e6a-4b4f-ae49-b800e98a261c.png#align=left&display=inline&height=474&name=image.png&originHeight=379&originWidth=690&size=86777&status=done&width=862.4999871477487" data-srcset="https://cdn.nlark.com/yuque/0/2019/png/187932/1557108843135-278143cd-9e6a-4b4f-ae49-b800e98a261c.png#align=left&display=inline&height=474&name=image.png&originHeight=379&originWidth=690&size=86777&status=done&width=862.4999871477487, https://cdn.nlark.com/yuque/0/2019/png/187932/1557108843135-278143cd-9e6a-4b4f-ae49-b800e98a261c.png#align=left&display=inline&height=474&name=image.png&originHeight=379&originWidth=690&size=86777&status=done&width=862.4999871477487 1.5x, https://cdn.nlark.com/yuque/0/2019/png/187932/1557108843135-278143cd-9e6a-4b4f-ae49-b800e98a261c.png#align=left&display=inline&height=474&name=image.png&originHeight=379&originWidth=690&size=86777&status=done&width=862.4999871477487 2x" data-sizes=auto alt="https://cdn.nlark.com/yuque/0/2019/png/187932/1557108843135-278143cd-9e6a-4b4f-ae49-b800e98a261c.png#align=left&display=inline&height=474&name=image.png&originHeight=379&originWidth=690&size=86777&status=done&width=862.4999871477487" title=image.png></li>
</ul>
<h2 id=micro-kernel>micro kernel</h2>
<p>特点：易于拓展，错误隔离，保持架构一致性
要点：</p>
<ul>
<li>内核包含公共流程或通用逻辑</li>
<li>将可变成或可扩展部分规划为扩展点</li>
<li>抽象扩展点行为，定义接口</li>
<li>利用插件进行扩展</li>
</ul>
<p>生产过程任务的开发</p>
<h2 id=内置-json-解析>内置 json 解析</h2>
<p>远程过程调用等过程中，会用 json，以及在配置文件中，很多使用 json</p>
<h2 id=easyjson>easyjson</h2>
<p>go 内置的，一般适用于配置文件解析，对于 qps 较高，运用了反射，效率较低。尽量使用高性能的 json 解析</p>
<h2 id=http-服务>HTTP 服务</h2>
<p><img class=lazyload src=/svg/loading.min.svg data-src="https://cdn.nlark.com/yuque/0/2019/png/187932/1557111353880-2f261975-45c5-4dcd-9281-44ac48f2fbcb.png#align=left&display=inline&height=442&name=image.png&originHeight=354&originWidth=862&size=103367&status=done&width=1077.499983943999" data-srcset="https://cdn.nlark.com/yuque/0/2019/png/187932/1557111353880-2f261975-45c5-4dcd-9281-44ac48f2fbcb.png#align=left&display=inline&height=442&name=image.png&originHeight=354&originWidth=862&size=103367&status=done&width=1077.499983943999, https://cdn.nlark.com/yuque/0/2019/png/187932/1557111353880-2f261975-45c5-4dcd-9281-44ac48f2fbcb.png#align=left&display=inline&height=442&name=image.png&originHeight=354&originWidth=862&size=103367&status=done&width=1077.499983943999 1.5x, https://cdn.nlark.com/yuque/0/2019/png/187932/1557111353880-2f261975-45c5-4dcd-9281-44ac48f2fbcb.png#align=left&display=inline&height=442&name=image.png&originHeight=354&originWidth=862&size=103367&status=done&width=1077.499983943999 2x" data-sizes=auto alt="https://cdn.nlark.com/yuque/0/2019/png/187932/1557111353880-2f261975-45c5-4dcd-9281-44ac48f2fbcb.png#align=left&display=inline&height=442&name=image.png&originHeight=354&originWidth=862&size=103367&status=done&width=1077.499983943999" title=image.png>
<img class=lazyload src=/svg/loading.min.svg data-src="https://cdn.nlark.com/yuque/0/2019/png/187932/1557111366213-f5138ca3-fd5f-4da1-992a-f68e1681d3ff.png#align=left&display=inline&height=445&name=image.png&originHeight=356&originWidth=771&size=101595&status=done&width=963.7499856390061" data-srcset="https://cdn.nlark.com/yuque/0/2019/png/187932/1557111366213-f5138ca3-fd5f-4da1-992a-f68e1681d3ff.png#align=left&display=inline&height=445&name=image.png&originHeight=356&originWidth=771&size=101595&status=done&width=963.7499856390061, https://cdn.nlark.com/yuque/0/2019/png/187932/1557111366213-f5138ca3-fd5f-4da1-992a-f68e1681d3ff.png#align=left&display=inline&height=445&name=image.png&originHeight=356&originWidth=771&size=101595&status=done&width=963.7499856390061 1.5x, https://cdn.nlark.com/yuque/0/2019/png/187932/1557111366213-f5138ca3-fd5f-4da1-992a-f68e1681d3ff.png#align=left&display=inline&height=445&name=image.png&originHeight=356&originWidth=771&size=101595&status=done&width=963.7499856390061 2x" data-sizes=auto alt="https://cdn.nlark.com/yuque/0/2019/png/187932/1557111366213-f5138ca3-fd5f-4da1-992a-f68e1681d3ff.png#align=left&display=inline&height=445&name=image.png&originHeight=356&originWidth=771&size=101595&status=done&width=963.7499856390061" title=image.png></p>
<h2 id=构建-restful-服务>构建 Restful 服务</h2>
<p>更好的 router，httprouter
面向资源的架构（Resource Oriented Architecture）</p>
<h2 id=性能分析工具>性能分析工具</h2>
<p>学习函数式编程：《计算机程序的构造和解释》functional programming
《Restful Web Service》
《Go 程序设计语言》
《面向模式的软件架构》1,2,3 本</p>
</div><div class=post-footer id=post-footer>
<div class=post-info>
<div class=post-info-line>
<div class=post-info-mod>
<span>更新于 2019-04-28</span>
</div>
<div class=post-info-license></div>
</div>
<div class=post-info-line>
<div class=post-info-md></div>
<div class=post-info-share>
<span></span>
</div>
</div>
</div>
<div class=post-info-more>
<section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/golang/>Golang</a></section>
<section>
<span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span>
</section>
</div>
<div class=post-nav><a href=/posts/yuque/mysql%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%803/ class=prev rel=prev title=MySQL学习基础(3)><i class="fas fa-angle-left fa-fw"></i>MySQL学习基础(3)</a>
<a href=/posts/yuque/git%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/ class=next rel=next title=【Git】Git使用总结>【Git】Git使用总结<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
</main><footer class=footer>
<div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.88.1">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
</div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2019 - 2021</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://github.com/mianhk target=_blank>mianhk</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div>
</div>
</footer></div>
<div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部>
<i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论>
<i class="fas fa-comment fa-fw"></i>
</a>
</div><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:10},comment:{},search:{highlightTag:"em",lunrLanguageCode:"zh",lunrSegmentitURL:"/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50}}</script><script type=text/javascript src=/js/theme.min.js></script></body>
</html>